<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- The time entry detail form, readonly -->
        <record id="hr_timekeeping_line_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.line.form</field>
            <field name="model">hr.timekeeping.line</field>
            <field name="arch" type="xml">
                <form string="Timesheet Activities">
                    <group>
                        <group>
                            <field name="date" readonly="1"/>
                            <field name="name" readonly="1"/>
                            <field name="unit_amount" widget="float_time" readonly="1"/>
                            <field name="start_time" widget="time" readonly="1"/>
                            <field name="end_time" widget="time" readonly="1"/>
                            <!--<field name="serial_reference" readonly="1"/>-->
                            <field name="workorders" readonly="1"/>
                            <field name="state" invisible="True"/>
                            <field name="logging_required" invisible="True"/>
                            <field name="amount" invisible="True" />
                            <field name="premium_amount" invisible="True" />
                            <field name="sheet_id" invisible="1"/>
                            <field name="user_id" invisible="1"/>
                            <field name="uid_is_user_id" invisible="1"/>
                            <field name="sheet_state" invisible="1"/>
                        </group>
                        <group>
                            <field name="dcaa_allowable" readonly="1"/>
                            <field name="routing_id" readonly="1"/>
                            <field name="routing_line_id" invisible="1"/>
                            <field name="routing_subrouting_id" readonly="1"/>
                            <field name="old_task_code" readonly="True" />
                            <field name="worktype" readonly="1"/>
                            <field name="location" readonly="1"/>
                        </group>
                    </group>
                </form>
            </field>
        </record>
        <!-- The time entry detail form, editable -->
        <record id="hr_timekeeping_line_form_editable" model="ir.ui.view">
            <field name="name">hr.timekeeping.line.form</field>
            <field name="model">hr.timekeeping.line</field>
            <field name="priority">20</field>
            <field name="arch" type="xml">
                <form string="Timesheet Activities">
                    <group>
                        <group>
                            <field name="type" invisible="1"/>
                            <field name="date" attrs="{'readonly':[('sheet_state','!=','draft')]}"/>
                            <field name="name" attrs="{'readonly':[('sheet_state','!=','draft')], 'required':[('unit_amount','!=',0.0)]}"
                                    autofocus="autofocus"/>
                            <field name="unit_amount" widget="float_time" string="Hours" sum="Hours" help="Time (1:30) or float (1.5) format"
                                    attrs="{'readonly':[('sheet_state','!=','draft')]}"/>
                            <field name="start_time" widget="time" attrs="{'readonly':[('sheet_state','!=','draft')]}"/>
                            <field name="end_time" widget="time" attrs="{'readonly':[('sheet_state','!=','draft')]}"/>
                            <!--<field name="serial_reference" attrs="{'readonly':[('sheet_state','!=','draft')], 'required':[('require_serial','=',True)]}"/>-->
                            <field name="workorders" attrs="{'readonly':[('sheet_state','!=','draft')], 'required':[('require_serial','=',True)]}"
                                   widget="many2many_tags" options="{'create': false, 'create_edit': false}" domain="[('active','=',True)]"/>
                            <field name="id" invisible="1"/>
                            <field name="require_serial" invisible="1"/>
                            <field name="state" invisible="1"/>
                            <field name="logging_required" invisible="1"/>
                            <field name="amount" invisible="1" />
                            <field name="premium_amount" invisible="1" />
                            <field name="sheet_id" invisible="1"/>
                            <field name="user_id" invisible="1"/>
                            <field name="uid_is_user_id" invisible="1"/>
                            <field name="sheet_state" invisible="1"/>
                        </group>
                        <group>
                            <field name="dcaa_allowable" attrs="{'readonly':[('sheet_state','!=','draft')]}"/>
                            <field name="routing_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                   domain="[('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"
                                   attrs="{'readonly':[('sheet_state','!=','draft')]}"/>
                            <field name="routing_line_id" options="{'create': false, 'create_edit': false}" widget="selection" invisible="1"
                                    domain="[('routing_id','=',routing_id),('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"/>
                            <field name="routing_subrouting_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                   attrs="{'readonly':[('sheet_state','!=','draft')]}"
                                   domain="[('routing_line_id','=',routing_line_id),('view_on_timesheet','=',sheet_id),
                                            ('dcaa_allowable','=',dcaa_allowable),('timesheets_future_filter','in',state)]" />
                            <field name="old_task_code" readonly="True" />
                            <field name="worktype" widget="selection" options="{'create': false, 'create_edit': false}"
                                   attrs="{'readonly':[('sheet_state','!=','draft')]}"
                                   domain="[('task_worktype_search','=',routing_subrouting_id)]"/>
                            <field name="location" options="{'create': false, 'create_edit': false}"
                                   attrs="{'readonly':[('sheet_state','!=','draft')]}"/>
                        </group>
                    </group>
                    <group attrs="{'invisible':[('sheet_state','!=','draft')]}">
                        <field name="change_reason" attrs="{'required':[('unit_amount','!=',0.0),('logging_required','=',True)],'invisible':[('logging_required','=',False)]}"/>
                        <field name="change_explanation" attrs="{'required':[('unit_amount','!=',0.0),('logging_required','=',True),('change_reason','=','Other')],'invisible':['|',('logging_required','=',False),('change_reason','!=','Other')]}" widget="text"/>
                    </group>
                    <group name="sow">
                        <field name="sow" string="Task SOW" readonly="1"/>
                        <field name="sow_examples" readonly="1"/>
                    </group>
                    <footer attrs="{'invisible':[('sheet_state','!=','draft')]}">
                        <button name="write" type="object" string="Save" class="oe_highlight"/> or
                        <button name="cancel" string="Cancel" special="cancel" class="oe_link" attrs="{'invisible':[('type','=','Correction')]}"/>
                        <button name="unlink" string="Delete this entry" type="object" class="oe_right" confirm="Are you sure you want to delete this entry?"
                                attrs="{'invisible':[('id','=',False)]}"/>
                    </footer>
                </form>
            </field>
        </record>
        <!-- Action for button of entry details-->
        <record id="action_timekeeping_line_details" model="ir.actions.act_window">
            <field name="name">Time Entry Details</field>
            <field name="res_model">hr.timekeeping.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="hr_timekeeping_line_form_editable"/>
            <field name="target">new</field>
        </record>

        <!-- The main timesheet form -->
        <record id="hr_timekeeping_sheet_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.form</field>
            <field name="model">hr.timekeeping.sheet</field>
            <field name="arch" type="xml">
                <form string="Timesheet" create="false" delete="false">
                <header>
                    <button name="button_confirm" string="Submit For Approval" type="object" class="oe_highlight oe_right"
                            attrs="{'invisible':[('submit_button_view','=',False)]}"
                            confirm="By submitting this timecard, you are certifying that you have reviewed it for accuracy and have determined that it is complete, accurate, and correct.  Do you want to submit this timecard?"/>
                    <button name="button_confirm" string="Proxy Submit" type="object" class="oe_highlight oe_right"
                            attrs="{'invisible':[('proxy_button_view','=',False)]}"/>
                    <button name="button_self_cancel" string="Set back to Open" type="object" class="oe_right"
                            attrs="{'invisible':['|',('state','!=','confirm'),'|',('uid_is_user_id','!=',True),'&amp;',('past_deadline','=',True),('type','=','regular')]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done"/>
                </header>
                <sheet>
                    <field name="uid_is_user_id" invisible="1"/>
                    <field name="editable_view" invisible="1"/>
                    <field name="submit_button_view" invisible="1"/>
                    <field name="proxy_button_view" invisible="1"/>
                    <field name="addendum_button_view" invisible="1"/>
                    <field name="past_deadline" invisible="1"/>
                    <field name="needs_correction" invisible="1"/>
                    <div class="oe_inline oe_right">
                        <a href="http://www.imsar.us/documentation/IPD_Internal_Procedure/IMSAR_Policies_and_Procedures_Manual_CURRENT.pdf" target="_blank">Timekeeping Instructions</a>
                    </div>
                    <div>
                        <h1><field name="employee_id" readonly="True"/></h1>
                        <button name="%(other_timesheets_view_form)d" class="oe_inline oe_right oe_stat_button" type="action"
                                icon="fa-book" context="{'search_default_type':'proxy','search_default_name':name}" attrs="{'invisible':['|',('type','!=','regular'),('proxy_count','=',0)]}">
                            <field name="proxy_count" class="oe_inline" string="Proxies" widget="statinfo"/>
                        </button>
                        <button name="%(other_timesheets_view_form)d" class="oe_inline oe_right oe_stat_button" type="action"
                                icon="fa-book" context="{'search_default_type':'addendum','search_default_name':name}" attrs="{'invisible':['|',('type','!=','regular'),('addendum_count','=',0)]}">
                            <field name="addendum_count" class="oe_inline" string="Addendums" widget="statinfo"/>
                        </button>
                        <button name="button_return_to_regular" class="oe_inline oe_right" type="object" string="Return to Regular"
                                attrs="{'invisible':[('type','=','regular')]}"/>
                    </div>
                    <group>
                        <group>
                            <button type="object" string="Previous Timesheet" name="button_previous_timesheet"
                                    attrs="{'invisible':['|',('type','!=','regular'),('uid_is_user_id','=',False)]}"/>
                            <button type="object" string="Next Timesheet" name="button_next_timesheet" class="oe_inline"
                                    attrs="{'invisible':['|',('type','!=','regular'),('uid_is_user_id','=',False)]}"/>
                            <field name="name"/>
                            <label for="date_from" string="Timesheet Period"/>
                            <div><field name="date_from" class="oe_inline"/> to <field name="date_to" class="oe_inline"/></div>
                            <field name="deadline"/>
                        </group>
                        <group>
                            <field name="employee_flsa_status" readonly="True"/>
                            <field name="employee_full_time" invisible="True"/>
                            <field name="type" string="Timesheet Type"/>
                            <field name="move_id" string="Journal Entry" attrs="{'invisible':[('state','!=','done')]}" groups="base.group_hr_user,account.group_account_user"/>
                        </group>
                    </group>
                    <group attrs="{'invisible':[('payroll_state','!=','pending')]}" groups="base.group_hr_user">
                        <button class="oe_highlight" type="object" string="Mark Submitted to Payroll" name="button_mark_payroll"
                                confirm="Confirm that you have manually made all the necessary adjustments in Quickbooks."/>
                    </group>
                    <group attrs="{'invisible':[('payroll_state','!=','failed')]}" groups="base.group_hr_user">
                        <button class="oe_highlight" type="object" string="Retry Payroll" name="button_retry_payroll"
                                confirm="Make sure you have fully deleted all entries from this timesheet entry in Quickbooks before retrying!"/>
                    </group>
                    <group attrs="{'invisible':[('addendum_button_view','=',False)]}">
                        <button class="oe_highlight" type="object" string="Create/Edit Addendum" name="button_addendum" />
                    </group>
                    <group attrs="{'invisible':['|',('type','!=','regular'),('state','!=','draft')]}" groups="imsar_timekeeping.group_timesheet_admin">
                        <button class="oe_highlight" type="object" string="Void Current Timesheet" name="button_void"
                                confirm="This will remove all entries from this timesheet and render it unusable (after saving a copy of the current entries).
                                This should only be done if you intend to create a proxy timesheet for this user. Are you sure you want to do this?"/>
                    </group>
                    <group attrs="{'invisible':['|',('needs_correction','=',False),('state','=','draft')]}" groups="imsar_timekeeping.group_timesheet_admin">
                        <button class="oe_inline" type="object" string="View Comments" name="button_view_comments" />
                        <button class="oe_highlight" type="object" string="Mark As Corrected" name="button_mark_corrected" />
                    </group>
                    <notebook>
                        <!-- page for editable time entries -->
                        <page string="Entries" attrs="{'invisible':[('editable_view','=',False)]}">
                            <button name="%(action_timekeeping_line_details)d" string="Add Entry" type="action" class="oe_edit_only"/>
                            <button name="write" type="object" string="Save Changes" class="oe_right oe_edit_only"
                                    attrs="{'invisible':['|',('state','!=','draft'),('uid_is_user_id','!=',True)]}"/>
                            <div style="display: inline-block; width: 100px;"/>
                            <button name="button_oneclick_add" type="object" string="Add One-Click Tasks" class="oe_bounce_container oe_edit_only"
                                    attrs="{'invisible':['|',('state','!=','draft'),'|',('type','!=','regular'),('uid_is_user_id','!=',True)]}"/>
                            <field name="line_ids" nolabel="1" attrs="{'readonly':['|',('uid_is_user_id','!=',True),('state','!=','draft')]}">
                                <tree string="Timesheet Activities" editable="top" create="false" delete="false"
                                    colors="black:display_color=='black';
                                            gray:display_color=='gray';
                                            maroon:display_color=='maroon';
                                            red:display_color=='red';
                                            purple:display_color=='purple';
                                            green:display_color=='green';
                                            olive:display_color=='olive';
                                            navy:display_color=='navy';
                                            teal:display_color=='teal';" >
                                    <field name="sheet_id" invisible="1"/>
                                    <field name="display_color" invisible="True"/>
                                    <field name="date" readonly="True"/>
                                    <field name="day_name" attrs="{'required':['|',('unit_amount','>',0.0)]}"/>
                                    <field name="routing_id" widget="selection" options="{'create': false, 'create_edit': false}"
                                           attrs="{'readonly':[('state','!=','open')]}"
                                           domain="[('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]" />
                                    <field name="routing_line_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                           attrs="{'readonly':[('state','!=','open')]}" invisible="True"
                                           domain="[('routing_id','=',routing_id),('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"/>
                                    <field name="routing_subrouting_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                           attrs="{'readonly':[('state','!=','open')]}"
                                           domain="[('routing_line_id','=',routing_line_id),('view_on_timesheet','=',sheet_id),
                                            ('dcaa_allowable','=',dcaa_allowable),('timesheets_future_filter','in',state)]" />
                                    <field name="name" attrs="{'required':['|',('unit_amount','!=',0.0)], 'readonly':['|',('state','!=','open')]}"/>
                                    <field name="unit_amount" widget="float_time" string="Hours" sum="Hours"
                                           attrs="{'readonly':['|',('state','!=','open')]}"/>
                                    <field name="location" attrs="{'required':['|',('unit_amount','!=',0.0)], 'readonly':['|',('state','!=','open')]}" string="Loc"/>
                                    <!--<field name="serial_reference" invisible="0"/>-->
                                    <field name="workorders" invisible="0"/>
                                    <button name="button_details" string="Details" type="object" class="oe_edit_only"
                                            attrs="{'invisible':[('sheet_state','!=','draft')]}"/>
                                    <!-- invisible fields -->
                                    <field name="dcaa_allowable" invisible="True"/>
                                    <field name="worktype" invisible="True" />
                                    <field name="state" invisible="True"/>
                                    <field name="sheet_state" invisible="True"/>
                                    <field name="date" invisible="True"/>
                                    <field name="logging_required" invisible="True"/>
                                    <field name="amount" invisible="True" />
                                    <field name="premium_amount" invisible="True" />
                                    <field name="change_explanation" invisible="True" />
                                    <field name="user_id" invisible="1"/>
                                    <field name="uid_is_user_id" invisible="1"/>
                                </tree>
                            </field>
                            <button name="%(action_timekeeping_line_details)d" string="Add Entry" type="action" class="oe_edit_only"/>
                        </page>
                        <!-- page for readonly time entries -->
                        <page string="Entries" attrs="{'invisible':[('editable_view','=',True)]}">
                            <field name="view_line_ids" nolabel="1" readonly="True">
                                <tree string="Timesheet Activities" create="false" edit="false" delete="false"
                                    colors="black:display_color=='black';
                                            gray:display_color=='gray';
                                            maroon:display_color=='maroon';
                                            red:display_color=='red';
                                            purple:display_color=='purple';
                                            green:display_color=='green';
                                            olive:display_color=='olive';
                                            navy:display_color=='navy';
                                            teal:display_color=='teal';" >
                                    <field name="display_color" invisible="True"/>
                                    <field name="date" />
                                    <field name="day_name"/>
                                    <field name="routing_id"/>
                                    <field name="routing_line_id" invisible="True"/>
                                    <field name="routing_subrouting_id"/>
                                    <field name="name"/>
                                    <field name="unit_amount" widget="float_time" string="Hours" sum="Hours"/>
                                    <field name="worktype" />
                                    <field name="location" />
                                    <!--<field name="serial_reference" />-->
                                    <field name="workorders" />
                                    <field name="uid_is_user_id" invisible="1"/>
                                    <field name="sheet_state" invisible="1"/>
                                    <button name="button_correction" string="Amend" type="object" class="oe_edit_only"
                                            attrs="{'invisible':['|',('sheet_state','=','draft'),('uid_is_user_id','!=',True)]}"/>
                                </tree>
                            </field>
                        </page>
                        <!-- page for weekly summary -->
                        <page string="Summary" invisible="0">
                            <widget type="timekeeping_weekly_summary"/>
                        </page>
                        <!-- page for approvals -->
                        <page string="Approvals" attrs="{'invisible':[('state','=','draft')]}">
                            <field name="approval_line_ids" nolabel="1" readonly="True">
                                <tree editable="False">
                                    <field name="type"/>
                                    <field name="account_analytic_id"/>
                                    <field name="relevant_time" widget="float_time"/>
                                    <field name="state"/>
                                    <field name="past_deadline" invisible="1"/>
                                    <field name="approved_by" readonly="True"/>
                                    <field name="uid_can_approve" invisible="True"/>
                                    <button name="button_approve" string="Approve" class="oe_highlight" type="object"
                                            attrs="{'invisible':['|',('state','!=','confirm'),('uid_can_approve','!=',True)]}"/>
                                    <button name="button_reject" string="Comment" class="oe_inline" type="object"
                                            attrs="{'invisible':['|',('state','!=','confirm'),'|',('uid_can_approve','!=',True)]}"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Payroll" attrs="{'invisible':[('state','!=','done')]}" groups="base.group_hr_user,account.group_account_user">
                            <group>
                                <field name="payroll_state" attrs="{'invisible':[('state','!=','done')]}"/>
                                <field name="payroll_comment" attrs="{'invisible':[('payroll_state','!=','failed')]}"/>
                            </group>
                            <group>
                                <field name="payment_date"/>
                                <field name="payment_comment"/>
                            </group>
                        </page>
                    </notebook>
                    <group>
                        <field name="subtotal_line"/>
                        <field name="pp_total_time_display" attrs="{'invisible':[('employee_full_time','=','False')]}"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_ids" widget="mail_thread"/>
                    <field name="message_follower_ids" widget="mail_followers"/>
                </div>
                </form>
            </field>
        </record>

        <!-- The time entry reject form -->
        <record id="hr_timekeeping_reject_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.comment.form</field>
            <field name="model">hr.timekeeping.comment</field>
            <field name="arch" type="xml">
                <form string="Timesheet Activities">
                    <group>
                        <!--<field name="sheet_id" invisible="True"/>-->
                        <field name="comment" widget="text"/>
                    </group>
                    <footer>
                        <button string="Submit" name="submit_explanation" type="object" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <!-- Action for reject approval button -->
        <record id="action_timekeeping_reject_form" model="ir.actions.act_window">
            <field name="name">Reject Timesheet</field>
            <field name="res_model">hr.timekeeping.comment</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="hr_timekeeping_reject_form"/>
            <field name="target">new</field>
        </record>

        <!-- Timesheet search filters -->
        <record id="view_hr_timekeeping_sheet_filter" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.filter</field>
            <field name="model">hr.timekeeping.sheet</field>
            <field name="arch" type="xml">
                <search string="Search Timesheet">
                    <field name="user_id"/>
                    <field name="name"/>
                    <field name="type"/>
                    <field name="includes_task"/>
                    <field name="employee_manager"/>
                    <filter name="draft" string="In Draft" domain="[('state','=','draft')]"/>
                    <filter name="to_approve" string="To Approve" domain="[('state','=','confirm')]"/>
                    <filter name="my_approvals" string="My Approvals" domain="[('adv_search','=','my_approvals')]"/>
                    <filter name="my_direct_approvals" string="My Direct Approvals" domain="[('adv_search','=','my_direct_approvals')]"/>
                    <filter name="my_user_id" string="My Timesheets" domain="[('user_id','=',uid)]"/>
                    <filter name="this_week" string="This Week" domain="[('adv_search','=','this_week')]"/>
                    <filter name="last_week" string="Last Week" domain="[('adv_search','=','last_week')]"/>
                    <filter name="this_payperiod" string="This Payperiod" domain="[('adv_search','=','this_payperiod')]"/>
                    <filter name="prev_payperiod" string="Previous Payperiod" domain="[('adv_search','=','prev_payperiod')]"/>
                    <filter name="pending_payroll" string="Pending Payroll" domain="[('state','=','done'),('payroll_state','in',['draft','pending','failed'])]"
                            groups="base.group_hr_user,account.group_account_user" />
                    <filter name="unpaid" string="Pending Payment" domain="[('state','=','done'),('payroll_state','=','submitted')]"
                            groups="base.group_hr_user,account.group_account_user" />
                    <group expand="0" string="Group By">
                        <filter name="group_by_employee" string="Employees" icon="terp-personal" context="{'group_by':'employee_id'}"/>
                        <filter name="group_by_name" string="Sheet Name" icon="terp-personal" context="{'group_by':'name'}"/>
                        <filter name="group_by_payperiod" string="Pay Period" icon="terp-personal" context="{'group_by':'payperiod_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Menus and stuff -->
        <menuitem id="menu_hr_timekeeping" name="Time Keeping" parent="hr.menu_hr_root" sequence="1"/>
        <menuitem id="hr.menu_hr_main" name="Company" parent="hr.menu_hr_root" sequence="10"/>
        <menuitem id="menu_hr_timekeeping_reports" name="Reporting" parent="hr.menu_hr_root" sequence="20" />

        <!-- My Current Timesheet menuitem -->
        <record id="action_hr_timekeeping_current_open" model="ir.actions.server">
            <field name="sequence" eval="5"/>
            <field name="state">code</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_hr_timekeeping_wizards"/>
            <field name="code">action = pool.get('hr.timekeeping.wizards').open_timesheet(cr, uid, None, context)</field>
            <field name="condition">True</field>
            <field name="name">My Current Timesheet</field>
        </record>
        <menuitem id="menu_act_hr_timekeeping_my_current" action="action_hr_timekeeping_current_open" parent="menu_hr_timekeeping" sequence="1"/>

        <!-- Addendum Timesheet -->
        <record id="action_hr_timekeeping_addendum_open" model="ir.actions.server">
            <field name="sequence" eval="5"/>
            <field name="state">code</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_hr_timekeeping_wizards"/>
            <field name="code">action = pool.get('hr.timekeeping.wizards').open_addendum(cr, uid, context)</field>
            <field name="condition">True</field>
            <field name="name">Timesheet Addendum</field>
        </record>

        <!-- Timesheets tree view-->
        <record id="past_timesheet_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.tree</field>
            <field name="model">hr.timekeeping.sheet</field>
            <field name="arch" type="xml">
                <tree string="Timesheets" create="false" delete="false"
                      colors="red:payroll_state=='failed';purple:type=='addendum';teal:type=='proxy';maroon:state=='void'">
                    <field name="employee_id" />
                    <field name="name" />
                    <field name="date_from" />
                    <field name="date_to" />
                    <field name="total_time" sum="Hours"/>
                    <field name="type" />
                    <field name="state" />
                    <field name="payroll_state" groups="base.group_hr_user"/>
                </tree>
            </field>
        </record>
        <!-- My Timesheets -->
        <record id="past_timesheets_view_form" model="ir.actions.act_window">
            <field name="name">My Timesheets</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="hr_timekeeping_sheet_form"/>
            <field name="domain">[('user_id','=',uid)]</field>
        </record>
        <record id="action_past_timesheets_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="past_timesheet_tree"/>
            <field name="act_window_id" ref="past_timesheets_view_form"/>
        </record>
        <menuitem id="menu_past_timesheets_view" action="past_timesheets_view_form" parent="menu_hr_timekeeping" sequence="2"/>
        <!-- All Timesheets -->
        <record id="all_timesheets_view_form" model="ir.actions.act_window">
            <field name="name">All Timesheets</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="hr_timekeeping_sheet_form"/>
            <field name="context">{'search_default_group_by_name':1}</field>
            <field name="domain">[('user_id','!=',1)]</field>
        </record>
        <record id="action_all_timesheets_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="past_timesheet_tree"/>
            <field name="act_window_id" ref="all_timesheets_view_form"/>
        </record>
        <menuitem id="menu_all_timesheets_view" action="all_timesheets_view_form" parent="menu_hr_timekeeping_reports" groups="base.group_hr_user,account.group_account_user" sequence="1"/>
        <!-- Need correction Timesheets -->
        <record id="correction_timesheets_view_form" model="ir.actions.act_window">
            <field name="name">Need Correction</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','=','done'),('needs_correction','=',True)]</field>
            <field name="view_id" eval="hr_timekeeping_sheet_form"/>
        </record>
        <record id="action_correction_timesheets_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="past_timesheet_tree"/>
            <field name="act_window_id" ref="correction_timesheets_view_form"/>
        </record>
        <menuitem id="menu_correction_timesheets_view" action="correction_timesheets_view_form" parent="menu_hr_timekeeping_reports" groups="base.group_hr_user,account.group_account_user" sequence="2"/>
        <!-- Addendums/Proxies -->
        <record id="other_timesheets_view_form" model="ir.actions.act_window">
            <field name="name">Related Timesheets</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="hr_timekeeping_sheet_form"/>
            <field name="domain">[('type','in',['addendum','proxy']),('user_id','=',uid)]</field>
        </record>
        <record id="action_other_timesheets_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="past_timesheet_tree"/>
            <field name="act_window_id" ref="other_timesheets_view_form"/>
        </record>

        <!-- Approval lines and My Approvals -->
        <record id="view_hr_timekeeping_approval_filter" model="ir.ui.view">
            <field name="name">hr.timekeeping.approval.filter</field>
            <field name="model">hr.timekeeping.approval</field>
            <field name="arch" type="xml">
                <search string="Search Approvals">
                    <field name="employee_id"/>
                    <field name="type"/>
                    <field name="sheet_id"/>
                    <field name="account_analytic_id"/>
                    <filter name="my_approvals" string="My Approvals" domain="[('adv_search','=','my_approvals')]"/>
                    <filter name="my_direct_approvals" string="My Direct Approvals" domain="[('adv_search','=','my_direct_approvals')]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_employee" string="Employees" icon="terp-personal" context="{'group_by':'employee_id'}"/>
                        <filter name="group_by_type" string="Type" icon="terp-personal" context="{'group_by':'type'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="approval_lines_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.approval.tree</field>
            <field name="model">hr.timekeeping.approval</field>
            <field name="arch" type="xml">
                <tree string="Approvals" create="false" delete="false"
                        colors="maroon:overtime > 0;">
                    <field name="state" invisible="1"/>
                    <field name="adv_search" invisible="1"/>
                    <field name="employee_id"/>
                    <field name="type" invisible="1"/>
                    <field name="past_deadline" invisible="1"/>
                    <field name="sheet_id" string="Week"/>
                    <field name="sheet_type" string="Type"/>
                    <field name="relevant_time" widget="float_time"/>
                    <field name="overtime" widget="float_time"/>
                    <field name="account_analytic_id"/>
                    <field name="employee_manager"/>
                    <field name="uid_can_approve" invisible="True"/>
                    <button name="button_approve" string="Approve" class="oe_highlight" type="object"
                            attrs="{'invisible':['|',('state','!=','confirm'),('uid_can_approve','!=',True)]}"/>
                    <button name="button_reject" string="Comment" class="oe_inline" type="object"
                            attrs="{'invisible':['|',('state','!=','confirm'),'|',('uid_can_approve','!=',True)]}"/>
                    <button name="button_view_timesheet" string="View Timesheet" type="object"
                            attrs="{'invisible':['|',('state','!=','confirm'),('uid_can_approve','!=',True)]}"/>
                </tree>
            </field>
        </record>

        <!-- Need My Approval Lines-->
        <record id="timesheets_approval_lines_view_form" model="ir.actions.act_window">
            <field name="name">My Approvals</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.approval</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('state','=','confirm')]</field>
            <field name="context">{'search_default_my_direct_approvals':1,'search_default_group_by_type':1}</field>
        </record>
        <record id="action_timesheets_approval_lines_tree" model="ir.actions.act_window.view">
            <field name="view_mode">tree</field>
            <field name="view_id" ref="approval_lines_tree"/>
            <field name="act_window_id" ref="timesheets_approval_lines_view_form"/>
        </record>
        <menuitem id="menu_act_hr_timekeeping_my_approval_lines_filter" action="timesheets_approval_lines_view_form" parent="menu_hr_timekeeping" sequence="3"/>

        <!-- Timekeeping user preferences -->
        <record id="user_preferences_form" model="ir.ui.view">
            <field name="name">timekeeping.preferences.form</field>
            <field name="model">hr.timekeeping.preferences</field>
            <field name="arch" type="xml">
                <form string="Timesheet" create="false" delete="false">
                    <sheet>
                        <group string="Default Category/Task">
                            <field name="routing_id" widget="selection" options="{'create': false, 'create_edit': false}"
                                   domain="[('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]" />
                            <field name="routing_line_id" options="{'create': false, 'create_edit': false}" widget="selection" invisible="1"
                                   domain="[('routing_id','=',routing_id),('section_ids','in',[%(imsar_timekeeping.ar_section_timekeeping)d])]"/>
                            <field name="routing_subrouting_id" options="{'create': false, 'create_edit': false}" widget="selection"
                                   domain="[('routing_line_id','=',routing_line_id),('user_has_reviewed','=',True)]" />
                        </group>
                        <group string="One-Click Tasks">
                            <field name="oneclick_tasks" nolabel="1" domain="[('oneclick_filter','=',True)]"
                                   options="{'create': false, 'create_edit': false}" >
                                <tree colors="black:display_color=='black';
                                            gray:display_color=='gray';
                                            maroon:display_color=='maroon';
                                            red:display_color=='red';
                                            purple:display_color=='purple';
                                            green:display_color=='green';
                                            olive:display_color=='olive';
                                            navy:display_color=='navy';
                                            teal:display_color=='teal';" >
                                    <field name="display_color" invisible="True"/>
                                    <field name="routing_id" string="Category"/>
                                    <field name="name" string="Task Code"/>
                                </tree>
                            </field>
                        </group>

                    </sheet>
                </form>
            </field>
        </record>
        <record id="action_user_preferences_form" model="ir.actions.server">
            <field name="sequence" eval="5"/>
            <field name="state">code</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_hr_timekeeping_wizards"/>
            <field name="code">action = pool.get('hr.timekeeping.wizards').open_preferences(cr, uid, None, context)</field>
            <field name="condition">True</field>
            <field name="name">Preferences</field>
        </record>
        <menuitem id="menu_user_preferences_form" action="action_user_preferences_form" parent="menu_hr_timekeeping" sequence="7"/>

        <!-- Send timesheets to payroll processing -->
        <record id="timesheet_send_to_payroll_view" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.payroll.form</field>
            <field name="model">hr.timekeeping.sheet.payroll.confirm</field>
            <field name="arch" type="xml">
                <form string="Confirm Payroll Submission">
                    Submit the selected timesheets for payroll processing.
                    <footer>
                        <button string="Submit" name="submit_confirm" type="object" default_focus="1" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <!-- Puts an option in the More button that calls a wizard -->
        <act_window id="timesheet_send_to_payroll" name="Submit to Payroll"
            res_model="hr.timekeeping.sheet.payroll.confirm" src_model="hr.timekeeping.sheet"
            multi="True" key2="client_action_multi"
            view_mode="form" target="new" view_type="form"
            groups="base.group_hr_user" />

        <!-- Mark timesheets as paid -->
        <record id="timesheet_mark_paid_view" model="ir.ui.view">
            <field name="name">hr.timekeeping.sheet.payment.form</field>
            <field name="model">hr.timekeeping.sheet.payment.confirm</field>
            <field name="arch" type="xml">
                <form string="Confirm Payment">
                    Enter the payment date and payment comment (including reference) to apply to the selected timesheets.
                    <group>
                        <field name="payment_date"/>
                        <field name="comment"/>
                    </group>
                    <footer>
                        <button string="Submit" name="submit_confirm" type="object" default_focus="1" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <!-- Puts an option in the More button that calls a wizard -->
        <act_window id="timesheet_mark_paid" name="Mark as Paid"
            res_model="hr.timekeeping.sheet.payment.confirm" src_model="hr.timekeeping.sheet"
            multi="True" key2="client_action_multi"
            view_mode="form" target="new" view_type="form"
            groups="base.group_hr_user" />

        <!-- Pay periods -->
        <record id="payperiod_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.payperiod.tree</field>
            <field name="model">hr.timekeeping.payperiod</field>
            <field name="arch" type="xml">
                <tree string="Pay Periods" >
                    <field name="name" />
                    <field name="start_date" />
                    <field name="end_date" />
                    <field name="pay_date" />
                </tree>
            </field>
        </record>
        <record id="payperiod_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.payperiod.form</field>
            <field name="model">hr.timekeeping.payperiod</field>
            <field name="arch" type="xml">
                <form string="Pay Periods" >
                    <group>
                        <group>
                            <field name="year" />
                            <field name="period_num" />
                        </group>
                        <group>
                            <field name="start_date" />
                            <field name="end_date" />
                            <field name="pay_date" />
                        </group>
                    </group>
                </form>
            </field>
        </record>
        <record id="payperiod_view" model="ir.actions.act_window">
            <field name="name">Pay Periods</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.payperiod</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="payperiod_tree"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Create Pay Periods to give timesheets payroll context.
              </p>
            </field>
        </record>
        <menuitem id="menu_payperiod_view" action="payperiod_view" parent="hr.menu_hr_configuration" name="Pay Periods" sequence="5"/>

        <!-- Holidays -->
        <record id="holiday_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.holiday.tree</field>
            <field name="model">hr.timekeeping.holiday</field>
            <field name="arch" type="xml">
                <tree string="Holidays" >
                    <field name="name" />
                    <field name="holiday_date" />
                </tree>
            </field>
        </record>
        <record id="holiday_form" model="ir.ui.view">
            <field name="name">hr.timekeeping.holiday.form</field>
            <field name="model">hr.timekeeping.holiday</field>
            <field name="arch" type="xml">
                <form string="Holidays" >
                    <group>
                        <field name="name" />
                        <field name="holiday_date" />
                    </group>
                </form>
            </field>
        </record>
        <record id="holiday_view" model="ir.actions.act_window">
            <field name="name">Holidays</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.holiday</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" eval="holiday_tree"/>
        </record>
        <menuitem id="menu_holiday_view" action="holiday_view" parent="hr.menu_hr_configuration" name="Holidays" sequence="6"/>

        <!-- Accounting Work Orders -->
        <record id="workorder_view" model="ir.actions.act_window">
            <field name="name">Work Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.timekeeping.workorder</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <!--<field name="view_id" eval="holiday_tree"/>-->
        </record>
        <menuitem id="menu_workorder_view" action="workorder_view" parent="hr.menu_hr_main" name="Work Orders" groups="base.group_hr_user,account.group_account_user" sequence="30"/>

        <!-- Timesheet lines for inventory report -->
        <record id="timesheet_inventory_report_tree" model="ir.ui.view">
            <field name="name">hr.timekeeping.line.inventory.tree</field>
            <field name="model">hr.timekeeping.line</field>
            <field name="arch" type="xml">
                <tree string="Timesheet lines" >
                    <field name="user_id" />
                    <field name="employee_number" />
                    <field name="date" />
                    <field name="name" />
                    <!--<field name="serial_reference" />-->
                    <field name="workorders" />
                    <field name="routing_id" />
                    <field name="routing_subrouting_id" />
                    <field name="unit_amount" string="Hours"/>
                    <field name="full_amount" />
                </tree>
            </field>
        </record>

        <!-- Create Proxy timesheet -->
        <record id="view_timekeeping_proxy_wizard" model="ir.ui.view">
             <field name="name">hr.timekeeping.proxy</field>
             <field name="model">hr.timekeeping.proxy</field>
             <field name="arch" type="xml">
                <form string="Search by week and project">
                    <group>
                        <field name="week_date"/>
                        <field name="employee" options="{'create': false, 'create_edit': false}"/>
                    </group>
                    <footer>
                        <button name="submit" string="Create" type="object"  class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel" />
                    </footer>
                </form>
             </field>
        </record>
        <record id="action_timekeeping_proxy_wizard" model="ir.actions.act_window">
            <field name="name">Create Proxy Timesheet</field>
            <field name="res_model">hr.timekeeping.proxy</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_timekeeping_proxy_wizard"/>
            <field name="target">new</field>
        </record>
        <menuitem id="menu_action_timekeeping_proxy_wizard" action="action_timekeeping_proxy_wizard" parent="hr.menu_hr_main" groups="base.group_hr_user" sequence="15"/>

        <!-- mail.message view for timesheets -->
        <record id="tk_mail_message_tree" model="ir.ui.view">
            <field name="name">hr.mail.message.tree</field>
            <field name="model">mail.message</field>
            <field name="arch" type="xml">
                <tree string="Comments">
                    <field name="body" widget="html" string="Comment"/>
                </tree>
            </field>
        </record>
        <record id="tk_mail_message_form" model="ir.ui.view">
            <field name="name">hr.mail.message.form</field>
            <field name="model">mail.message</field>
            <field name="arch" type="xml">
                <form string="Comments" >
                    <group>
                        <field name="subject"/>
                        <field name="body" widget="html"/>
                    </group>
                </form>
            </field>
        </record>

    </data>
</openerp>
